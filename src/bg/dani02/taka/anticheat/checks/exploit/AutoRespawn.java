package bg.dani02.taka.anticheat.checks.exploit;

import org.bukkit.scheduler.BukkitRunnable;

import com.comphenix.protocol.events.PacketEvent;

import bg.dani02.taka.anticheat.CheatPlayer;
import bg.dani02.taka.anticheat.ConfigsMessages;
import bg.dani02.taka.anticheat.Taka;
import bg.dani02.taka.anticheat.Utils;
import bg.dani02.taka.anticheat.enums.HackType;

public class AutoRespawn {
	public static void onCheck(PacketEvent event) {
		if(!Utils.checkModule(Utils.getCheatPlayer(event.getPlayer().getUniqueId()), HackType.EXPLOIT_AUTORESPAWN))
			return;
		// Bug in 1.15+
		if(event.getPlayer().getWorld().isGameRule("doImmediateRespawn"))
			return;

		// If respawn
		if (event.getPacket().getClientCommands().read(0).ordinal() == 0) {
			CheatPlayer p = Utils.getCheatPlayer(event.getPlayer().getUniqueId());

			if (System.currentTimeMillis() - p.getLastDeathTime() < 1000) {
				event.setCancelled(true);

				new BukkitRunnable() {

					@Override
					public void run() {
						p.getPlayer().kickPlayer(
								Utils.prepareColors(Utils.getTakaPrefix() + ConfigsMessages.autorespawn_kickMsg));
					}
				}.runTask(Taka.getThisPlugin());
			}
		}
	}

}